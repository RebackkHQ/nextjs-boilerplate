name: "Standard Release Workflow"

on:
  push:
    branches:
      - main

permissions: write-all

jobs:
  dependencies:
    name: ğŸ“¦ Dependencies
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: latest
      - run: npm install && npm ci

  lint:
    name: ğŸ§¹ Lint
    runs-on: ubuntu-latest
    needs: dependencies
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: latest
      - run: npm install && npm ci
      - name: Lint
        run: npm run lint:fix

  audit:
    name: ğŸ›¡ï¸ Audit
    runs-on: ubuntu-latest
    needs: dependencies
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: latest
      - run: npm install && npm ci
      - name: ğŸ›¡ï¸ Audit
        run: npm audit --audit-level=high

  test:
    name: ğŸ§ª Test
    runs-on: ubuntu-latest
    needs: dependencies
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: latest
      - run: npm install && npm ci
      - name: âš¡ Test
        run: npm run dev & npm run test:ci

  release:
    name: ğŸš€ Release
    runs-on: ubuntu-latest
    needs: [dependencies, lint, audit, test]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: latest
      - run: npm install && npm ci
      - name: Release
        run: npm run build && npm run semantic-release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
